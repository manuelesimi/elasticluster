# hpc-common/tasks/main.yml
---

- name: Load distribution-specific parameters
  include_tasks: 'init-{{ansible_os_family}}.yml'


- name: Install common HPC software
  package:
    name: '{{hpc_common_packages}}'
    state: '{{ pkg_install_state }}'


- name: Ensure modulefiles directories exist
  file:
    dest: '{{item}}'
    state: directory
  loop:
    - '/etc/modulefiles'
    - '/etc/modulefiles/mpi'


# RHEL/CentOS already ship an `openmpi-x86_64` module
- name: Deploy OpenMPI environment module
  template:
    dest: '/etc/modulefiles/mpi/openmpi'
    src: 'etc/modulefiles/mpi/openmpi.tcl.j2'
    mode: '0444'
  when: 'is_debian_compatible'
