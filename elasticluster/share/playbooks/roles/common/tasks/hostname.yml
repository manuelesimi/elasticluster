---
#
# Ensure the node host name matches the Ansible inventory name
#

# work around for Ansible's lack of support for "Scientific Linux CERN";
# temporarily set distribution ID to "Scientific Linux"
- name: Patch `/etc/redhat-release`
  replace:
        dest='/etc/redhat-release'
        regexp='Scientific Linux CERN SLC'
        replace='Scientific Linux'
  when: 'ansible_lsb.id == "ScientificCERNSLC"'


- name: Set host name to Ansible "inventory name"
  hostname: 
    name='{{inventory_hostname}}'


# undo SLC workaround
- name: Undo patch to `/etc/redhat-release`
  replace:
        dest='/etc/redhat-release'
        regexp='Scientific Linux'
        replace='Scientific Linux CERN SLC'
  # if facts were gathered again now, `ansible_lsb.id` would be "Scientific"
  # instead -- this playbook critically relies on Ansible gathering facts only
  # at the beginning of the run
  when: 'ansible_lsb.id == "ScientificCERNSLC"'
