---
- name: Common configuration
  hosts: pbs_master:pbs_clients:maui_master
  vars_files:
    - vars/os
  tasks:
    - include: common/tasks/gc3repo.yml

    - name: configure /etc/hosts file
      action: template src=pbs+maui/templates/hosts.j2 dest=/etc/hosts owner=root group=root

    - name: set hostname
      action: command hostname $inventory_hostname

- name: PBS masternode Playbook
  hosts: pbs_master
  vars_files:
    - vars/os
  tasks: 
    - include: slurm/tasks/nfs.yml
    - include: pbs+maui/tasks/master.yml
    - include: pbs+maui/tasks/main.yml
  handlers:
    - include: pbs+maui/handlers/main.yml

- name: MAUI masternode Playbook
  hosts: maui_master
  vars_files:
    - vars/os
  tasks: 
    - include: pbs+maui/tasks/maui.yml
  handlers:
    - include: pbs+maui/handlers/main.yml

- name: PBS worker nodes Playbook
  hosts: pbs_clients
  vars_files:
    - vars/os
  tasks: 
    - include: slurm/tasks/nfs-clients.yml nfsserver=${groups.pbs_master[0]}
    - include: pbs+maui/tasks/clients.yml
    - include: pbs+maui/tasks/main.yml
  handlers:
    - include: pbs+maui/handlers/main.yml

